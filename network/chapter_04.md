# 무엇을 공부 했는가?

네트워크 4장의 핵심은, 데이터를 수신하는 경로가 되는 `라우터` 가 어떻게 경로를 설정하고, 데이터를 수신하는 지 정의와 동작 원리에 대해 설명한다.

그리고, 3계층에서 핵심이 된 IP 이외에도 에러 보고 프로토콜인 `ICMP`의 개념에 대해서도 공부하고 이를 통해 ICMP가 송신하는 메시지에 대해서도 배우게 된다.

## 라우터의 시작은 MAC 주소로 부터

- `어느 네트워크를 통해서 경유할 까?` 이 물음에 대한 답변으로, 중계해 줄 장소의 데이터를 MAC 주소를 통해서 알아간다.

- 다시 말하자면 MAC 주소 - MAC 주소 -.. 이 연속된 경로로 데이터를 전송하는 일을 `라우팅` 이라고 하고, 이 작업을 가능하게 하는 것을 `라우터` 라고 부르는 것

- 다음 길을 제시해서 가는 방법을 `홉 바이 홉` 이라고 부른다.

- 다음 행선지는 MAC 주소가, 최종 행선지는 IP 주소가 알려주는 셈이다.

## 테이블, 브로드캐스트는 데이터 송신과 수신의 중심적인 개념

- 라우터에도 라우터 테이블이 존재한다. 
- 그 말은, 수신처까지 도달하기 위해 필요한 정보들이 테이블로 매칭이 되어있다는 말과 상응한다.
- 라우팅 테이블에는 `수신처 네트워크까지의 거리`, `다음에 도달하게 될 라우터의 정보`, `그 라우터에 연결되어 있는 자신의 인터페이스` 를 포함한다.

## 라우터의 특성

- 네트워크 경계선상에 존재하기 때문에 복수의 네트워크끼리 연결이 가능하다.

- 그 말은, 필요한 데이터도 선택적으로 수신 받는다는 이야기도 포함이 되어있는데 `필터링` 과정을 거쳐서 특정 패킷의 데이터만 수신하도록 하는 작업을 포함한다.

- 재밌는 점은, 다음 수신처를 찾아내는 방식을 `최장일치의 룰`을 사용해서, IP 주소의 비트열과 네트워크 주소의 비트열을 앞에서부터 순서대로 비교해서 가장 많이 일치하는 것부터 선택한다.

- `브로드캐스트`는 라우터를 넘어서서 송신되지 않는다. 그 말은, 브로드캐스트를 사용하는 ARP로 부터 수신처에 대한 주소를 수신받지 못한다는 이야기다.

- 그렇다면 라우터는 브로드캐스트를 사용하지 못하는 것일까?

- 아니다. 컴퓨터는 `디폴트 게이트웨이`를 통해 라우터에서 최초로 데이터를 보내는데, 이 디폴트 게이트웨이로 `ARP`를 수행한다.

- 어떻게 가능할 수 있을까? `디폴트 게이트웨이`를 통해 다른 호스트로 패킷이 진입하면, 외부 호스트 기준에서는 같은 네트워크 상에 존재하므로 ARP가 가능한 것이다.

- 그러면 디폴트 게이트웨이는 IP 주소가 필요로 할 것이다. 마찬가지로 디폴트 게이트웨이의 IP 설정 방식은 `DHCP`로 `디폴트 게이트웨이`: `IP 주소` 매칭이 가능하다.

- 매칭 과정을 가능하게 해 주는 것은? 네트워크 관리자.

## 라우팅의 개념

라우팅을 할 때, 중요한 특징이 하나 더 있다. 수신처 까지의 최적 경로를 찾아야 하는 점이다.

- 최적의 경로를 찾기위해 가장 단순하게 떠올릴 수 있는 방법은 무엇이 있을까?

- 아마 `여러 경로를 알아내고`, `비교하는 방법`일 것이다.

- 최적 경로를 찾아내는 방법도 크게 다르지 않다.

## 우리가 흔히 알고있는 라우팅은 동적 라우팅이다.

- 수동 라우팅의 경우, 네트워크 장애가 생겼거나 우회로 변경을 시도하는 경우에는 관리자가 수동으로 경로 변경을 해줘야 한다.

- 모든 라우터가 동일한 정보를 가지고 있는 상태를 `컨버전스`라고 부르는데, 네트워크의 라우터들은 이 컨버전스가 유지 되어야 한다.

- 장애가 한 곳에서 생겼다면, 네트워크 내에서는 모든 라우터가 장애 정보를 공유해야 한다는 점.

- 동적 라우팅은 라우터끼리 자동으로 정보를 교환해서 경로를 알아가는 방법 인 셈이다.

- 동적 라우팅은 그만큼 패킷 교환을 하기 때문에 회선 전송에 부하가 생길 수 있다.

- 그럼에도, 자동으로 장애를 제거할 수 있는 이점이 존재하기 마련이다.

## 동적 라우팅에서 필요한 정보를 얻기 위해 라우팅 프로토콜을 사용한다.

- 프로토콜이 의미하는 바가 그렇 듯, 라우터끼리 정보를 교환하기 위한 약속이다.

- 동적 라우팅의 결과는 정보를 교환한 것을 바탕으로 라우팅 테이블을 변경하는 데 있다.

- 이 과정은 수신처의 AS -> AS 내부에서 각 네트워크에 라우팅을 수행하는 방식으로 진행된다.

- 그러면 라우팅 프로토콜도 크게 두 종류로 나눌 수 있을 것이다. `AS - AS 간의 라우팅 용`과 `AS 내부의 네트워크 라우팅 용`.

- 라우팅 프로토콜은 경로 정보를 언제, 어떻게, 누구에게, 어떤 정보를 전송할 지를 담고 있다.

## 메트릭

- 최적의 경로를 결정할 때의 판단 기준이다.
- 중계하는 라우터의 수, 회선의 속도, 정체 상태, 에러 발생률의 판단 기준에 따라서 값을 계산한다.
- 그 중 최소 값을 갖는 경로를 최적의 경로라고 판단한다.

## 메트릭에서 수신처 네트워크까지 통과하는 라우터 수를 사용하는 RIP 동작을 알아보자

- RIP 동작의 핵심은 `거리`와 `방향` 이다.
- 라우팅 업데이트를 교환하고 모르는 경로 정보를 입수한다.
- 30초에 1번으로 이 작업이 1회 진행 되는데, 6번 모두 수신받지 않으면 장애가 있다고 판단해서 해당 라우터를 사용하는 경로들을 파기한다.

- 라우팅 업데이트를 수신하면, 자신이 모르는 네트워크를 테이블에 작성한다. 당연히 업데이트를 보내온 라우터는 중계 라우터로, 업데이트를 받은 인터페이스를 송신 인터페이스로 지정한다. 

## 송신이 불가능한 메시지들을 어떻게 주고 받을까?

- ICMP
- 수신처에 도달하지 않는 이유를 통지 할 때 라우터 혹은 호스트가 ICMP의 타입 3을 보낸다.
- 타입과 함께 도달할 수 없는 이유를 코드로 붙여서 반환한다.
- 이 때, IP 데이터그램은 라우터를 경유할 때마다 1씩 감소하는데, 0이 되는 순간 데이터그램이 파기된다. 파기 될 때까지의 시간을 줄여서 `TTL`이라고 부른다.

